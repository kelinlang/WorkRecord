## C++ 内存相关

- 内存存储区
  - 栈：自动释放
    - 函数参数值，
    - 局部变量
  - 堆：new/malloc分配对应由delete/free释放
  - 自由存储区
  - 全局/静态存储区  ：编译时分配好了
    - 全局变量
    - 静态变量
  - 字符/文字常量存储区
    - 常量字符串
  - 程序代码区
- **内存对齐**
  - 性能原因：内存对齐可以提高存取效率（例如，有些平台每次读都是从偶地址开始，如果一个 int 型
    存放在偶地址开始的地方，那么一个读周期就可以读出这 32bit，而如果存放在奇地址开始的地方，
    就需要 2 个读周期，并且要对两次读出的结果的高低字节进行拼凑才能得到这 32bit 的数据）  
  - 平台原因：各个硬件平台对存储空间的处理有很大的不同，一些平台对某些特定类型的数据只能从某
    些特定地址开始存取，例如，有些架构的 CPU 在访问一个没有对齐的变量时会发生错误，那么这时
    候编程必须保证字节对齐  
- **内存问题排查工具**
  - **vagrint**
    - Memcheck
      - 使用为初始化的内存
      - 使用已经释放的内存
      - 使用超过malloc分配的内存空间
      - 堆和栈的非法访问
      - 内存泄漏
      - malloc/free/new/delete申请和释放内存的匹配
      - src和dst的重叠
    - **内存检测原理**
    - 确定的内存泄露
      - 直接的内存泄露（definitely lost）：直接是没有任何指针指向该内存
      -  间接的内存泄露（indirectly lost）：间接是指向该内存的指针都位于内存泄露处，即由直接内
        存泄露引起的内存泄露
    - 可能的内存泄露（possibly lost）：指仍然存在某个指针能够访问某块内存，但该指针指向的已经不
      是该内存首地址  
- 内存泄漏避免方法
  - 智能指针
  - 工具检测代码
  - 严格代码设计

